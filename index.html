<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <!--
      The VBA Shrink-Ray!
 parameters will be replaced with the
      document title extracted from the <h1> element or
      file name, if there is no <h1> heading
    -->
    <title>VBA Shrink-Ray!
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="http://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="http://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="content/style.css" />
    <script src="content/tips.js" type="text/javascript"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body>
    <div class="container">
        <div class="row" style="margin-top:30px">
            <div class="span1"></div>
            <div class="span10" id="main">
                <h1>VBA Shrink-Ray!</h1>

<p>Being able to easily and regularly visualize how much <strong>legacy code</strong> exists
in your application's codebase - as <a href="https://twitter.com/danmil">Dan Milstein</a> describes in his article
<a href="http://onstartups.com/tabid/3339/bid/97052/Screw-You-Joel-Spolsky-We-re-Rewriting-It-From-Scratch.aspx">Screw you Joel Spolsky, We're Rewriting It From Scratch!</a>; is a key tool
in measuring success.</p>

<p>This is a script that helps treat a codebase like data - for use in doing a
<strong>re-write</strong>; and targets <code>VBA</code> code in a reasonably naive way. But should 
still remain valuable.</p>
<h2>VBA</h2>

<p>First things first - we need some types to represent the domain of <code>VBA</code> code.</p>

<p>To begin with I'm <strong>really not</strong> going to go too mad. I can actually work 
towards leaning quite a lot of information with just a few small data types:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="c">/// Represents a line of code - which as we know can be only either executable</span>
<span class="c">/// code or a line of commenting.</span>
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">lineOfCode</span> <span class="o">=</span> 
    | <span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="i">Code</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="i">string</span>
    | <span onmouseout="hideTip(event, 'fs4', 4)" onmouseover="showTip(event, 'fs4', 4)" class="i">Comment</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs3', 5)" onmouseover="showTip(event, 'fs3', 5)" class="i">string</span>

<span class="c">/// Represent bindings of args, parameters, variables as a name</span>
<span class="c">/// and optional type information.</span>
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs5', 6)" onmouseover="showTip(event, 'fs5', 6)" class="i">allocation</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs6', 7)" onmouseover="showTip(event, 'fs6', 7)" class="i">Allocation</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs3', 8)" onmouseover="showTip(event, 'fs3', 8)" class="i">string</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs3', 9)" onmouseover="showTip(event, 'fs3', 9)" class="i">string</span> <span onmouseout="hideTip(event, 'fs7', 10)" onmouseover="showTip(event, 'fs7', 10)" class="i">option</span>

<span class="c">/// Record of information about a procedure call.</span>
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs8', 11)" onmouseover="showTip(event, 'fs8', 11)" class="i">procedureInfo</span> <span class="o">=</span> { 
    
    <span class="c">/// The name bound to the procudure.</span>
    <span onmouseout="hideTip(event, 'fs9', 12)" onmouseover="showTip(event, 'fs9', 12)" class="i">Name</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs3', 13)" onmouseover="showTip(event, 'fs3', 13)" class="i">string</span>
    
    <span class="c">/// The optional list of arguments required to call the procedure.</span>
    <span onmouseout="hideTip(event, 'fs10', 14)" onmouseover="showTip(event, 'fs10', 14)" class="i">Args</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs5', 15)" onmouseover="showTip(event, 'fs5', 15)" class="i">allocation</span> <span onmouseout="hideTip(event, 'fs11', 16)" onmouseover="showTip(event, 'fs11', 16)" class="i">list</span> <span onmouseout="hideTip(event, 'fs7', 17)" onmouseover="showTip(event, 'fs7', 17)" class="i">option</span>
      
    <span class="c">/// All of the lines of code that make up the procedure, inclusive of the</span>
    <span class="c">/// procedure decleration, ending and comments.</span>
    <span onmouseout="hideTip(event, 'fs12', 18)" onmouseover="showTip(event, 'fs12', 18)" class="i">LinesOfCode</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs1', 19)" onmouseover="showTip(event, 'fs1', 19)" class="i">lineOfCode</span> <span onmouseout="hideTip(event, 'fs13', 20)" onmouseover="showTip(event, 'fs13', 20)" class="i">seq</span>
}

<span class="c">/// Available types of procedure calls - procedures are either Sub-Procedures</span>
<span class="c">/// or they are Function-Procedures.</span>
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs14', 21)" onmouseover="showTip(event, 'fs14', 21)" class="i">procedure</span> <span class="o">=</span>    
    | <span onmouseout="hideTip(event, 'fs15', 22)" onmouseover="showTip(event, 'fs15', 22)" class="i">Sub</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs8', 23)" onmouseover="showTip(event, 'fs8', 23)" class="i">procedureInfo</span>
    | <span onmouseout="hideTip(event, 'fs16', 24)" onmouseover="showTip(event, 'fs16', 24)" class="i">Function</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs8', 25)" onmouseover="showTip(event, 'fs8', 25)" class="i">procedureInfo</span></pre>
</td>
</tr>
</table><p>With just these few types we can probably generate the following information
pretty easily:</p>

<ul>
<li>Number of lines of <code>Code</code>.</li>
<li>Number of lines of <code>Comment</code>.</li>
<li>Total number of lines of code.</li>
<li>Total number of <code>Sub</code> and <code>Function</code> procedures.</li>
<li>Total number of calls to each <code>Sub</code> and <code>Function</code> procedures.</li>
<li>Details of the arguments required by both <code>Sub</code> and <code>Function</code> procedures.</li>
</ul>
<h3>Helpers</h3>

<p>I was initially going to set the following helper functions to hidden - but in 
retrospect I'm going to leave them in; I think it us useful to see how I arrive
at my solution with a little explanation of intent etc.</p>

<p>First up are a couple of helper functions to let me work with <code>option</code> types in
a slightly more elegant way, reducing the code noise.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="c">/// Applies a function &#39;f&#39; to an option &#39;a&#39;, where &#39;a&#39; has a value and returns</span>
<span class="c">/// some value - else the result is obviously nothing.</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs17', 26)" onmouseover="showTip(event, 'fs17', 26)" class="i">maybe</span> <span onmouseout="hideTip(event, 'fs18', 27)" onmouseover="showTip(event, 'fs18', 27)" class="i">f</span> <span onmouseout="hideTip(event, 'fs19', 28)" onmouseover="showTip(event, 'fs19', 28)" class="i">a</span> <span class="o">=</span> 
    <span class="k">match</span> <span onmouseout="hideTip(event, 'fs19', 29)" onmouseover="showTip(event, 'fs19', 29)" class="i">a</span> <span class="k">with</span>
    | <span onmouseout="hideTip(event, 'fs20', 30)" onmouseover="showTip(event, 'fs20', 30)" class="i">Some</span> <span onmouseout="hideTip(event, 'fs21', 31)" onmouseover="showTip(event, 'fs21', 31)" class="i">b</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs20', 32)" onmouseover="showTip(event, 'fs20', 32)" class="i">Some</span> (<span onmouseout="hideTip(event, 'fs18', 33)" onmouseover="showTip(event, 'fs18', 33)" class="i">f</span> <span onmouseout="hideTip(event, 'fs21', 34)" onmouseover="showTip(event, 'fs21', 34)" class="i">b</span>)
    | <span onmouseout="hideTip(event, 'fs22', 35)" onmouseover="showTip(event, 'fs22', 35)" class="i">None</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs22', 36)" onmouseover="showTip(event, 'fs22', 36)" class="i">None</span>

<span class="c">/// Turns a collection into an optional collection - where an empty collection</span>
<span class="c">/// is represented as nothing.</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs23', 37)" onmouseover="showTip(event, 'fs23', 37)" class="i">isAny</span> <span onmouseout="hideTip(event, 'fs24', 38)" onmouseover="showTip(event, 'fs24', 38)" class="i">xs</span> <span class="o">=</span> <span class="k">if</span> <span onmouseout="hideTip(event, 'fs25', 39)" onmouseover="showTip(event, 'fs25', 39)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs26', 40)" onmouseover="showTip(event, 'fs26', 40)" class="i">isEmpty</span> <span onmouseout="hideTip(event, 'fs24', 41)" onmouseover="showTip(event, 'fs24', 41)" class="i">xs</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs22', 42)" onmouseover="showTip(event, 'fs22', 42)" class="i">None</span> <span class="k">else</span> <span onmouseout="hideTip(event, 'fs20', 43)" onmouseover="showTip(event, 'fs20', 43)" class="i">Some</span> <span onmouseout="hideTip(event, 'fs24', 44)" onmouseover="showTip(event, 'fs24', 44)" class="i">xs</span></pre>
</td>
</tr>
</table><p>Given that we're essentially parsing large bodies of text and trying work with
them as if it is data - we're going to be needing a few helper functions for
working with strings. A few are just functional wrappers over existing string
methods, so we can more easily use functional idions like <a href="http://fsharpforfunandprofit.com/posts/convenience-partial-application/">partial application</a>
and <a href="http://fsharpforfunandprofit.com/posts/function-composition/">function composition</a>.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="c">/// Normalize line endings in a string.</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs27', 45)" onmouseover="showTip(event, 'fs27', 45)" class="i">normalizeLineEndings</span> <span onmouseout="hideTip(event, 'fs28', 46)" onmouseover="showTip(event, 'fs28', 46)" class="i">ending</span> <span onmouseout="hideTip(event, 'fs29', 47)" onmouseover="showTip(event, 'fs29', 47)" class="i">s</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs30', 48)" onmouseover="showTip(event, 'fs30', 48)" class="i">Regex</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs31', 49)" onmouseover="showTip(event, 'fs31', 49)" class="i">Replace</span>(<span class="i">input</span><span class="o">=</span><span onmouseout="hideTip(event, 'fs29', 50)" onmouseover="showTip(event, 'fs29', 50)" class="i">s</span>, <span class="i">pattern</span><span class="o">=</span><span class="s">&quot;</span><span class="s">\r</span><span class="s">\n</span><span class="s">|</span><span class="s">\n</span><span class="s">\r</span><span class="s">|</span><span class="s">\n</span><span class="s">|</span><span class="s">\r</span><span class="s">&quot;</span>, <span class="i">replacement</span><span class="o">=</span><span onmouseout="hideTip(event, 'fs28', 51)" onmouseover="showTip(event, 'fs28', 51)" class="i">ending</span>)

<span class="c">/// Splits a string based on a an array of given splitter strings. By default</span>
<span class="c">/// we will remove all empty entries from the result set.</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs32', 52)" onmouseover="showTip(event, 'fs32', 52)" class="i">split</span> (<span onmouseout="hideTip(event, 'fs33', 53)" onmouseover="showTip(event, 'fs33', 53)" class="i">splitters</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs3', 54)" onmouseover="showTip(event, 'fs3', 54)" class="i">string</span>[]) (<span onmouseout="hideTip(event, 'fs29', 55)" onmouseover="showTip(event, 'fs29', 55)" class="i">s</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs3', 56)" onmouseover="showTip(event, 'fs3', 56)" class="i">string</span>) <span class="o">=</span> 
    <span onmouseout="hideTip(event, 'fs29', 57)" onmouseover="showTip(event, 'fs29', 57)" class="i">s</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs34', 58)" onmouseover="showTip(event, 'fs34', 58)" class="i">Split</span>(<span class="i">separator</span><span class="o">=</span><span onmouseout="hideTip(event, 'fs33', 59)" onmouseover="showTip(event, 'fs33', 59)" class="i">splitters</span>, <span class="i">options</span><span class="o">=</span><span onmouseout="hideTip(event, 'fs35', 60)" onmouseover="showTip(event, 'fs35', 60)" class="i">StringSplitOptions</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs36', 61)" onmouseover="showTip(event, 'fs36', 61)" class="i">RemoveEmptyEntries</span>)
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs25', 62)" onmouseover="showTip(event, 'fs25', 62)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs37', 63)" onmouseover="showTip(event, 'fs37', 63)" class="i">ofArray</span>

<span class="c">/// Trims both ends of a specified string.</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs38', 64)" onmouseover="showTip(event, 'fs38', 64)" class="i">trim</span> (<span onmouseout="hideTip(event, 'fs29', 65)" onmouseover="showTip(event, 'fs29', 65)" class="i">s</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs3', 66)" onmouseover="showTip(event, 'fs3', 66)" class="i">string</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs29', 67)" onmouseover="showTip(event, 'fs29', 67)" class="i">s</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs39', 68)" onmouseover="showTip(event, 'fs39', 68)" class="i">Trim</span>()

<span class="c">/// Trims both ends of all strings in a specified collection.</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs40', 69)" onmouseover="showTip(event, 'fs40', 69)" class="i">trimAll</span> <span onmouseout="hideTip(event, 'fs41', 70)" onmouseover="showTip(event, 'fs41', 70)" class="i">xs</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs25', 71)" onmouseover="showTip(event, 'fs25', 71)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs42', 72)" onmouseover="showTip(event, 'fs42', 72)" class="i">map</span> <span onmouseout="hideTip(event, 'fs38', 73)" onmouseover="showTip(event, 'fs38', 73)" class="i">trim</span> <span onmouseout="hideTip(event, 'fs41', 74)" onmouseover="showTip(event, 'fs41', 74)" class="i">xs</span>

<span class="c">/// Results in true of a given string starts with a specified string value.</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs43', 75)" onmouseover="showTip(event, 'fs43', 75)" class="i">startsWith</span> <span onmouseout="hideTip(event, 'fs44', 76)" onmouseover="showTip(event, 'fs44', 76)" class="i">find</span> (<span onmouseout="hideTip(event, 'fs29', 77)" onmouseover="showTip(event, 'fs29', 77)" class="i">s</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs3', 78)" onmouseover="showTip(event, 'fs3', 78)" class="i">string</span>) <span class="o">=</span> 
    <span onmouseout="hideTip(event, 'fs29', 79)" onmouseover="showTip(event, 'fs29', 79)" class="i">s</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs45', 80)" onmouseover="showTip(event, 'fs45', 80)" class="i">StartsWith</span>(<span class="i">value</span><span class="o">=</span><span onmouseout="hideTip(event, 'fs44', 81)" onmouseover="showTip(event, 'fs44', 81)" class="i">find</span>, <span class="i">comparisonType</span><span class="o">=</span><span onmouseout="hideTip(event, 'fs46', 82)" onmouseover="showTip(event, 'fs46', 82)" class="i">StringComparison</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs47', 83)" onmouseover="showTip(event, 'fs47', 83)" class="i">CurrentCultureIgnoreCase</span>)

<span class="c">/// Removes all empty empty strings from a given collection, resulting in an</span>
<span class="c">/// optional collection if there are still any values in it.</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs48', 84)" onmouseover="showTip(event, 'fs48', 84)" class="i">removeEmpty</span> <span class="o">=</span> (<span onmouseout="hideTip(event, 'fs25', 85)" onmouseover="showTip(event, 'fs25', 85)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs49', 86)" onmouseover="showTip(event, 'fs49', 86)" class="i">filter</span> (<span onmouseout="hideTip(event, 'fs50', 87)" onmouseover="showTip(event, 'fs50', 87)" class="i">String</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs51', 88)" onmouseover="showTip(event, 'fs51', 88)" class="i">IsNullOrWhiteSpace</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs52', 89)" onmouseover="showTip(event, 'fs52', 89)" class="i">not</span>)) <span class="o">&gt;</span><span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs23', 90)" onmouseover="showTip(event, 'fs23', 90)" class="i">isAny</span></pre>
</td>
</tr>
</table><h3>Transformation</h3>

<p>So now we have a few helper functions to get us underway with working with 
our values - we can start making sense of constructing our domain model from
the data we're provided; transforming the raw strings into something we can 
more easily work with.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="c">/// Naive line tokenizer that breaks a string into the separate lines.</span>
<span class="c">///</span>
<span class="c">/// TODO: VB syntax allows the use of the &#39;_&#39; character to specify that a line</span>
<span class="c">/// logically continues onto the next physical line. We should probably handle</span>
<span class="c">/// this in the future.</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs53', 91)" onmouseover="showTip(event, 'fs53', 91)" class="i">tokenizeLines</span> <span class="o">=</span> 
    
    <span class="c">// We will use the standard windows line endings for this.</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs54', 92)" onmouseover="showTip(event, 'fs54', 92)" class="i">windowsLineEnding</span> <span class="o">=</span> <span class="s">&quot;</span><span class="s">\r</span><span class="s">\n</span><span class="s">&quot;</span>

    <span onmouseout="hideTip(event, 'fs27', 93)" onmouseover="showTip(event, 'fs27', 93)" class="i">normalizeLineEndings</span> <span onmouseout="hideTip(event, 'fs54', 94)" onmouseover="showTip(event, 'fs54', 94)" class="i">windowsLineEnding</span>
    <span class="o">&gt;</span><span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs32', 95)" onmouseover="showTip(event, 'fs32', 95)" class="i">split</span> [|<span onmouseout="hideTip(event, 'fs54', 96)" onmouseover="showTip(event, 'fs54', 96)" class="i">windowsLineEnding</span>|]
    <span class="o">&gt;</span><span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs40', 97)" onmouseover="showTip(event, 'fs40', 97)" class="i">trimAll</span>
    <span class="o">&gt;</span><span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs48', 98)" onmouseover="showTip(event, 'fs48', 98)" class="i">removeEmpty</span>
    </pre>
</td>
</tr>
</table><p>Not all lines of code are created equal - some are executable, and some are 
purely commenting.</p>

<p>We'll need another function that can take each line we have and work out what
they actually are.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="c">/// VB syntax defines the &#39; character as a way to mark a comment follows. Since</span>
<span class="c">/// all lines (including executable ones) can have a &#39; in them, we can at this</span>
<span class="c">/// point only say that a line starting with a &#39; are purely a line of comment.</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs55', 99)" onmouseover="showTip(event, 'fs55', 99)" class="i">lineOfCode</span> <span onmouseout="hideTip(event, 'fs29', 100)" onmouseover="showTip(event, 'fs29', 100)" class="i">s</span> <span class="o">=</span> <span class="k">if</span> <span onmouseout="hideTip(event, 'fs43', 101)" onmouseover="showTip(event, 'fs43', 101)" class="i">startsWith</span> <span class="s">&quot;</span><span class="s">&#39;</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs29', 102)" onmouseover="showTip(event, 'fs29', 102)" class="i">s</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs4', 103)" onmouseover="showTip(event, 'fs4', 103)" class="i">Comment</span> <span onmouseout="hideTip(event, 'fs29', 104)" onmouseover="showTip(event, 'fs29', 104)" class="i">s</span> <span class="k">else</span> <span onmouseout="hideTip(event, 'fs2', 105)" onmouseover="showTip(event, 'fs2', 105)" class="i">Code</span> <span onmouseout="hideTip(event, 'fs29', 106)" onmouseover="showTip(event, 'fs29', 106)" class="i">s</span>

<span class="c">/// Map function to turn a collection of strings into an optional collection of</span>
<span class="c">/// lines of code.</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs56', 107)" onmouseover="showTip(event, 'fs56', 107)" class="i">linesOfCode</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs53', 108)" onmouseover="showTip(event, 'fs53', 108)" class="i">tokenizeLines</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs17', 109)" onmouseover="showTip(event, 'fs17', 109)" class="i">maybe</span> (<span onmouseout="hideTip(event, 'fs25', 110)" onmouseover="showTip(event, 'fs25', 110)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs42', 111)" onmouseover="showTip(event, 'fs42', 111)" class="i">map</span> <span onmouseout="hideTip(event, 'fs55', 112)" onmouseover="showTip(event, 'fs55', 112)" class="i">lineOfCode</span>)</pre>
</td>
</tr>
</table><p>I've come quite far now and don't want go too much further without documenting
a couple of test cases so we can see some of this basic transformation working.
This will help us trust/reason what is going on with later functions.</p>

<p>I've been using the <a href="http://msdn.microsoft.com/en-us/library/dd233175.aspx">F# Interactive</a> (the REPL for F# programming) to test
the behaviour of each of these functions so far - I won't bore you with the 
output of all the testing for all of the functions; but I will demonstrate the
output from using the <code>linesOfCode</code> function.</p>

<p>Here is a little test helper function that takes a <em>test name</em> and then the 
value to pass into the <code>linesOfCode</code> function, interrogate the results and
print them nicely to the screen.</p>

<p>What follows is a few test runs with a few different scenarios:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="c">/// Takes a string as input and runs it through our &#39;linesOfCode&#39; function</span>
<span class="c">/// and prints the results in what should be nice and readable.</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs57', 113)" onmouseover="showTip(event, 'fs57', 113)" class="i">``test linesOfCode``</span> <span onmouseout="hideTip(event, 'fs58', 114)" onmouseover="showTip(event, 'fs58', 114)" class="i">str</span> <span onmouseout="hideTip(event, 'fs59', 115)" onmouseover="showTip(event, 'fs59', 115)" class="i">name</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs60', 116)" onmouseover="showTip(event, 'fs60', 116)" class="i">printfn</span> <span class="s">&quot;</span><span class="s">Test</span><span class="s">:</span><span class="s"> </span><span class="s">%</span><span class="s">s</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs59', 117)" onmouseover="showTip(event, 'fs59', 117)" class="i">name</span>
    <span class="k">match</span> <span onmouseout="hideTip(event, 'fs56', 118)" onmouseover="showTip(event, 'fs56', 118)" class="i">linesOfCode</span> <span onmouseout="hideTip(event, 'fs58', 119)" onmouseover="showTip(event, 'fs58', 119)" class="i">str</span> <span class="k">with</span>
    | <span onmouseout="hideTip(event, 'fs22', 120)" onmouseover="showTip(event, 'fs22', 120)" class="i">None</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs60', 121)" onmouseover="showTip(event, 'fs60', 121)" class="i">printfn</span> <span class="s">&quot;</span><span class="s">WARN</span><span class="s">!</span><span class="s"> </span><span class="s">No</span><span class="s"> </span><span class="s">lines</span><span class="s"> </span><span class="s">of</span><span class="s"> </span><span class="s">code</span><span class="s"> </span><span class="s">found</span><span class="s">.</span><span class="s">&quot;</span>
    | <span onmouseout="hideTip(event, 'fs20', 122)" onmouseover="showTip(event, 'fs20', 122)" class="i">Some</span> <span onmouseout="hideTip(event, 'fs61', 123)" onmouseover="showTip(event, 'fs61', 123)" class="i">lines</span> <span class="k">-&gt;</span>        
        <span onmouseout="hideTip(event, 'fs25', 124)" onmouseover="showTip(event, 'fs25', 124)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs62', 125)" onmouseover="showTip(event, 'fs62', 125)" class="i">iteri</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs63', 126)" onmouseover="showTip(event, 'fs63', 126)" class="i">i</span> <span onmouseout="hideTip(event, 'fs64', 127)" onmouseover="showTip(event, 'fs64', 127)" class="i">l</span> <span class="k">-&gt;</span> 
            <span onmouseout="hideTip(event, 'fs60', 128)" onmouseover="showTip(event, 'fs60', 128)" class="i">printfn</span> <span class="s">&quot;</span><span class="s">Line</span><span class="s"> </span><span class="s">%</span><span class="s">i</span><span class="s">:</span><span class="s"> </span><span class="s">%</span><span class="s">A</span><span class="s">&quot;</span> (<span onmouseout="hideTip(event, 'fs63', 129)" onmouseover="showTip(event, 'fs63', 129)" class="i">i</span><span class="o">+</span><span class="n">1</span>) <span onmouseout="hideTip(event, 'fs64', 130)" onmouseover="showTip(event, 'fs64', 130)" class="i">l</span>
        ) <span onmouseout="hideTip(event, 'fs61', 131)" onmouseover="showTip(event, 'fs61', 131)" class="i">lines</span>
    <span onmouseout="hideTip(event, 'fs60', 132)" onmouseover="showTip(event, 'fs60', 132)" class="i">printfn</span> <span class="s">&quot;</span><span class="s">&quot;</span> <span class="c">// for some clarity.</span>

<span class="c">// Example 1</span>
<span class="s">&quot;</span><span class="s">Empty</span><span class="s"> </span><span class="s">strings</span><span class="s"> </span><span class="s">should</span><span class="s"> </span><span class="s">yield</span><span class="s"> </span><span class="s">no</span><span class="s"> </span><span class="s">lines</span><span class="s"> </span><span class="s">of</span><span class="s"> </span><span class="s">code</span><span class="s">.</span><span class="s">&quot;</span> 
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs57', 133)" onmouseover="showTip(event, 'fs57', 133)" class="i">``test linesOfCode``</span> <span class="s">&quot;</span><span class="s">&quot;</span>

<span class="c">// Example 2</span>
<span class="s">&quot;</span><span class="s">A</span><span class="s"> </span><span class="s">few</span><span class="s"> </span><span class="s">lines</span><span class="s"> </span><span class="s">of</span><span class="s"> </span><span class="s">whitespace</span><span class="s"> </span><span class="s">should</span><span class="s"> </span><span class="s">yield</span><span class="s"> </span><span class="s">no</span><span class="s"> </span><span class="s">lines</span><span class="s"> </span><span class="s">of</span><span class="s"> </span><span class="s">code</span><span class="s">.</span><span class="s">&quot;</span> 
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs57', 134)" onmouseover="showTip(event, 'fs57', 134)" class="i">``test linesOfCode``</span> <span class="s">&quot;&quot;&quot;</span>


<span class="s">&quot;&quot;&quot;</span>

<span class="c">// Example 3</span>
<span class="s">&quot;</span><span class="s">One</span><span class="s"> </span><span class="s">line</span><span class="s"> </span><span class="s">statement</span><span class="s"> </span><span class="s">should</span><span class="s"> </span><span class="s">yield</span><span class="s"> </span><span class="s">1</span><span class="s"> </span><span class="s">line</span><span class="s"> </span><span class="s">of</span><span class="s"> </span><span class="s">code</span><span class="s">.</span><span class="s">&quot;</span>
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs57', 135)" onmouseover="showTip(event, 'fs57', 135)" class="i">``test linesOfCode``</span> <span class="s">&quot;</span><span class="s">Dim</span><span class="s"> </span><span class="s">s</span><span class="s"> </span><span class="s">=</span><span class="s"> </span><span class="s">\&quot;</span><span class="s">Hello</span><span class="s">,</span><span class="s"> </span><span class="s">world</span><span class="s">!</span><span class="s">\&quot;</span><span class="s">&quot;</span>

<span class="c">// Example 4</span>
<span class="s">&quot;</span><span class="s">A</span><span class="s"> </span><span class="s">3</span><span class="s"> </span><span class="s">lines</span><span class="s"> </span><span class="s">with</span><span class="s"> </span><span class="s">a</span><span class="s"> </span><span class="s">comment</span><span class="s">,</span><span class="s"> </span><span class="s">should</span><span class="s"> </span><span class="s">yield</span><span class="s"> </span><span class="s">2</span><span class="s"> </span><span class="s">lines</span><span class="s"> </span><span class="s">of</span><span class="s"> </span><span class="s">code</span><span class="s"> </span><span class="s">and</span><span class="s"> </span><span class="s">1</span><span class="s"> </span><span class="s">comment</span><span class="s">&quot;</span>
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs57', 136)" onmouseover="showTip(event, 'fs57', 136)" class="i">``test linesOfCode``</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    </span><span class="s">Sub</span><span class="s"> </span><span class="s">ZeroArgumentSubProcedure</span><span class="s">(</span><span class="s">)</span>
<span class="s">        </span><span class="s">&#39;</span><span class="s">does</span><span class="s"> </span><span class="s">nothing</span>
<span class="s">    </span><span class="s">End</span><span class="s"> </span><span class="s">Sub</span>
<span class="s">&quot;&quot;&quot;</span></pre>
</td>
</tr>
</table><p>Here are the test results from the output in the REPL:</p>

<pre><code>Test: Empty strings should yield no lines of code.
WARN! No lines of code found.

Test: A few lines of whitespace should yield no lines of code.
WARN! No lines of code found.

Test: One line statement should yield 1 line of code.
Line 1: Code "Dim s = "Hello, world!""

Test: A 3 lines with a comment, should yield 2 lines of code and 1 comment
Line 1: Code "Sub ZeroArgumentSubProcedure()"
Line 2: Comment "'does nothing"
Line 3: Code "End Sub"
</code></pre>

<p>Excellent! - that seems to be working great. It'll break if we deliberately 
throw some <code>null</code>'s at it - but I plan to ensure that won't happen as I read
the data in, so shouldn't be the case here.</p>

<p>At this point I think we can start getting some meaningful data already. We 
should now very easily be able to calculate the total numbers of lines of
code in a given codebase:</p>

<ul>
<li>Number of lines of <code>Code</code>.</li>
<li>Number of lines of <code>Comment</code>.</li>
<li>Total number of lines.</li>
</ul>

<p>That's already 50% of our original set of requirements above!</p>

<p>This can probably be done with some simple <a href="http://fsharpforfunandprofit.com/posts/monoids-part2/">map/reduce</a>:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="c">/// Counts the number of executable lines of code.</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs65', 137)" onmouseover="showTip(event, 'fs65', 137)" class="i">codeLineCount</span> <span onmouseout="hideTip(event, 'fs61', 138)" onmouseover="showTip(event, 'fs61', 138)" class="i">lines</span> <span class="o">=</span> 
    <span onmouseout="hideTip(event, 'fs61', 139)" onmouseover="showTip(event, 'fs61', 139)" class="i">lines</span>
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs25', 140)" onmouseover="showTip(event, 'fs25', 140)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs42', 141)" onmouseover="showTip(event, 'fs42', 141)" class="i">map</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs66', 142)" onmouseover="showTip(event, 'fs66', 142)" class="i">line</span> <span class="k">-&gt;</span>
        <span class="k">match</span> <span onmouseout="hideTip(event, 'fs66', 143)" onmouseover="showTip(event, 'fs66', 143)" class="i">line</span> <span class="k">with</span>
        | <span onmouseout="hideTip(event, 'fs2', 144)" onmouseover="showTip(event, 'fs2', 144)" class="i">Code</span> _ <span class="k">-&gt;</span> <span class="n">1</span>
        | <span onmouseout="hideTip(event, 'fs4', 145)" onmouseover="showTip(event, 'fs4', 145)" class="i">Comment</span> _ <span class="k">-&gt;</span> <span class="n">0</span>
    )
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs25', 146)" onmouseover="showTip(event, 'fs25', 146)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs67', 147)" onmouseover="showTip(event, 'fs67', 147)" class="i">sum</span>

<span class="c">/// Counts the number of comment lines.</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs68', 148)" onmouseover="showTip(event, 'fs68', 148)" class="i">commentLineCount</span> <span onmouseout="hideTip(event, 'fs61', 149)" onmouseover="showTip(event, 'fs61', 149)" class="i">lines</span> <span class="o">=</span> 
    <span onmouseout="hideTip(event, 'fs61', 150)" onmouseover="showTip(event, 'fs61', 150)" class="i">lines</span>
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs25', 151)" onmouseover="showTip(event, 'fs25', 151)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs42', 152)" onmouseover="showTip(event, 'fs42', 152)" class="i">map</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs66', 153)" onmouseover="showTip(event, 'fs66', 153)" class="i">line</span> <span class="k">-&gt;</span>
        <span class="k">match</span> <span onmouseout="hideTip(event, 'fs66', 154)" onmouseover="showTip(event, 'fs66', 154)" class="i">line</span> <span class="k">with</span>
        | <span onmouseout="hideTip(event, 'fs2', 155)" onmouseover="showTip(event, 'fs2', 155)" class="i">Code</span> _ <span class="k">-&gt;</span> <span class="n">0</span>
        | <span onmouseout="hideTip(event, 'fs4', 156)" onmouseover="showTip(event, 'fs4', 156)" class="i">Comment</span> _ <span class="k">-&gt;</span> <span class="n">1</span>
    )
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs25', 157)" onmouseover="showTip(event, 'fs25', 157)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs67', 158)" onmouseover="showTip(event, 'fs67', 158)" class="i">sum</span>

<span class="c">/// Counts total number of lines of code.</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs69', 159)" onmouseover="showTip(event, 'fs69', 159)" class="i">totalLineCount</span> <span onmouseout="hideTip(event, 'fs70', 160)" onmouseover="showTip(event, 'fs70', 160)" class="i">lines</span> <span class="o">=</span> 
    <span onmouseout="hideTip(event, 'fs70', 161)" onmouseover="showTip(event, 'fs70', 161)" class="i">lines</span>
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs25', 162)" onmouseover="showTip(event, 'fs25', 162)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs42', 163)" onmouseover="showTip(event, 'fs42', 163)" class="i">map</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs71', 164)" onmouseover="showTip(event, 'fs71', 164)" class="i">line</span> <span class="k">-&gt;</span> <span class="n">1</span>)
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs25', 165)" onmouseover="showTip(event, 'fs25', 165)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs67', 166)" onmouseover="showTip(event, 'fs67', 166)" class="i">sum</span></pre>
</td>
</tr>
</table><p>I'm going to redefine my <code>test</code> function above so as I can prove these few
map/reduce functions are correct:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="c">/// Takes a string as input and runs it through our &#39;linesOfCode&#39; function</span>
<span class="c">/// and prints the results in what should be nice and readable.</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs72', 167)" onmouseover="showTip(event, 'fs72', 167)" class="i">``test aggregate functions``</span> <span onmouseout="hideTip(event, 'fs58', 168)" onmouseover="showTip(event, 'fs58', 168)" class="i">str</span> <span onmouseout="hideTip(event, 'fs59', 169)" onmouseover="showTip(event, 'fs59', 169)" class="i">name</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs60', 170)" onmouseover="showTip(event, 'fs60', 170)" class="i">printfn</span> <span class="s">&quot;</span><span class="s">Test</span><span class="s">:</span><span class="s"> </span><span class="s">%</span><span class="s">s</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs59', 171)" onmouseover="showTip(event, 'fs59', 171)" class="i">name</span>
    <span class="k">match</span> <span onmouseout="hideTip(event, 'fs56', 172)" onmouseover="showTip(event, 'fs56', 172)" class="i">linesOfCode</span> <span onmouseout="hideTip(event, 'fs58', 173)" onmouseover="showTip(event, 'fs58', 173)" class="i">str</span>  <span class="k">with</span>
    | <span onmouseout="hideTip(event, 'fs22', 174)" onmouseover="showTip(event, 'fs22', 174)" class="i">None</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs60', 175)" onmouseover="showTip(event, 'fs60', 175)" class="i">printfn</span> <span class="s">&quot;</span><span class="s">WARN</span><span class="s">!</span><span class="s"> </span><span class="s">No</span><span class="s"> </span><span class="s">lines</span><span class="s"> </span><span class="s">of</span><span class="s"> </span><span class="s">code</span><span class="s"> </span><span class="s">found</span><span class="s">.</span><span class="s">&quot;</span>
    | <span onmouseout="hideTip(event, 'fs20', 176)" onmouseover="showTip(event, 'fs20', 176)" class="i">Some</span> <span onmouseout="hideTip(event, 'fs61', 177)" onmouseover="showTip(event, 'fs61', 177)" class="i">lines</span> <span class="k">-&gt;</span> 
        <span onmouseout="hideTip(event, 'fs61', 178)" onmouseover="showTip(event, 'fs61', 178)" class="i">lines</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs65', 179)" onmouseover="showTip(event, 'fs65', 179)" class="i">codeLineCount</span> <span class="o">|&gt;</span> (<span onmouseout="hideTip(event, 'fs60', 180)" onmouseover="showTip(event, 'fs60', 180)" class="i">printfn</span> <span class="s">&quot;</span><span class="s">Number</span><span class="s"> </span><span class="s">of</span><span class="s"> </span><span class="s">lines</span><span class="s"> </span><span class="s">of</span><span class="s"> </span><span class="s">Code</span><span class="s">:</span><span class="s"> </span><span class="s">%</span><span class="s">i</span><span class="s">&quot;</span>) 
        <span onmouseout="hideTip(event, 'fs61', 181)" onmouseover="showTip(event, 'fs61', 181)" class="i">lines</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs68', 182)" onmouseover="showTip(event, 'fs68', 182)" class="i">commentLineCount</span> <span class="o">|&gt;</span> (<span onmouseout="hideTip(event, 'fs60', 183)" onmouseover="showTip(event, 'fs60', 183)" class="i">printfn</span> <span class="s">&quot;</span><span class="s">Number</span><span class="s"> </span><span class="s">of</span><span class="s"> </span><span class="s">lines</span><span class="s"> </span><span class="s">of</span><span class="s"> </span><span class="s">Comments</span><span class="s">:</span><span class="s"> </span><span class="s">%</span><span class="s">i</span><span class="s">&quot;</span>) 
        <span onmouseout="hideTip(event, 'fs61', 184)" onmouseover="showTip(event, 'fs61', 184)" class="i">lines</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs69', 185)" onmouseover="showTip(event, 'fs69', 185)" class="i">totalLineCount</span> <span class="o">|&gt;</span> (<span onmouseout="hideTip(event, 'fs60', 186)" onmouseover="showTip(event, 'fs60', 186)" class="i">printfn</span> <span class="s">&quot;</span><span class="s">Total</span><span class="s">:</span><span class="s"> </span><span class="s">%</span><span class="s">i</span><span class="s">&quot;</span>) 
    <span onmouseout="hideTip(event, 'fs60', 187)" onmouseover="showTip(event, 'fs60', 187)" class="i">printfn</span> <span class="s">&quot;</span><span class="s">&quot;</span> <span class="c">// for some clarity.</span>

<span class="c">// Example 1</span>
<span class="s">&quot;</span><span class="s">Empty</span><span class="s"> </span><span class="s">strings</span><span class="s"> </span><span class="s">should</span><span class="s"> </span><span class="s">yield</span><span class="s"> </span><span class="s">no</span><span class="s"> </span><span class="s">lines</span><span class="s"> </span><span class="s">of</span><span class="s"> </span><span class="s">code</span><span class="s">.</span><span class="s">&quot;</span> 
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs72', 188)" onmouseover="showTip(event, 'fs72', 188)" class="i">``test aggregate functions``</span> <span class="s">&quot;</span><span class="s">&quot;</span>

<span class="c">// Example 2</span>
<span class="s">&quot;</span><span class="s">A</span><span class="s"> </span><span class="s">few</span><span class="s"> </span><span class="s">lines</span><span class="s"> </span><span class="s">of</span><span class="s"> </span><span class="s">whitespace</span><span class="s"> </span><span class="s">should</span><span class="s"> </span><span class="s">yield</span><span class="s"> </span><span class="s">no</span><span class="s"> </span><span class="s">lines</span><span class="s"> </span><span class="s">of</span><span class="s"> </span><span class="s">code</span><span class="s">.</span><span class="s">&quot;</span> 
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs72', 189)" onmouseover="showTip(event, 'fs72', 189)" class="i">``test aggregate functions``</span> <span class="s">&quot;&quot;&quot;</span>


<span class="s">&quot;&quot;&quot;</span>

<span class="c">// Example 3</span>
<span class="s">&quot;</span><span class="s">One</span><span class="s"> </span><span class="s">line</span><span class="s"> </span><span class="s">statement</span><span class="s"> </span><span class="s">should</span><span class="s"> </span><span class="s">yield</span><span class="s"> </span><span class="s">1</span><span class="s"> </span><span class="s">line</span><span class="s"> </span><span class="s">of</span><span class="s"> </span><span class="s">code</span><span class="s">.</span><span class="s">&quot;</span>
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs72', 190)" onmouseover="showTip(event, 'fs72', 190)" class="i">``test aggregate functions``</span> <span class="s">&quot;</span><span class="s">Dim</span><span class="s"> </span><span class="s">s</span><span class="s"> </span><span class="s">=</span><span class="s"> </span><span class="s">\&quot;</span><span class="s">Hello</span><span class="s">,</span><span class="s"> </span><span class="s">world</span><span class="s">!</span><span class="s">\&quot;</span><span class="s">&quot;</span>

<span class="c">// Example 4</span>
<span class="s">&quot;</span><span class="s">A</span><span class="s"> </span><span class="s">3</span><span class="s"> </span><span class="s">lines</span><span class="s"> </span><span class="s">with</span><span class="s"> </span><span class="s">a</span><span class="s"> </span><span class="s">comment</span><span class="s">,</span><span class="s"> </span><span class="s">should</span><span class="s"> </span><span class="s">yield</span><span class="s"> </span><span class="s">2</span><span class="s"> </span><span class="s">lines</span><span class="s"> </span><span class="s">of</span><span class="s"> </span><span class="s">code</span><span class="s"> </span><span class="s">and</span><span class="s"> </span><span class="s">1</span><span class="s"> </span><span class="s">comment</span><span class="s"> </span><span class="s">and</span><span class="s"> </span><span class="s">3</span><span class="s"> </span><span class="s">total</span><span class="s">.</span><span class="s">&quot;</span>
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs72', 191)" onmouseover="showTip(event, 'fs72', 191)" class="i">``test aggregate functions``</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    </span><span class="s">Sub</span><span class="s"> </span><span class="s">ZeroArgumentSubProcedure</span><span class="s">(</span><span class="s">)</span>
<span class="s">        </span><span class="s">&#39;</span><span class="s">does</span><span class="s"> </span><span class="s">nothing</span>
<span class="s">    </span><span class="s">End</span><span class="s"> </span><span class="s">Sub</span>
<span class="s">&quot;&quot;&quot;</span></pre>
</td>
</tr>
</table><p>The resulting output in our REPL:</p>

<pre><code>Test: Empty strings should yield no lines of code.
WARN! No lines of code found.

Test: A few lines of whitespace should yield no lines of code.
WARN! No lines of code found.

Test: One line statement should yield 1 line of code.
Number of lines of Code: 1
Number of lines of Comments: 0
Total: 1

Test: A 3 lines with a comment, should yield 2 lines of code and 1 comment and 3 total.
Number of lines of Code: 2
Number of lines of Comments: 1
Total: 3
</code></pre>

                <div class="tip" id="fs1">type lineOfCode =<br />&#160;&#160;| Code of string<br />&#160;&#160;| Comment of string<br /><br />Full name: ShrinkRay.lineOfCode<br /><em><br /><br />&#160;Represents a line of code - which as we know can be only either executable<br />&#160;code or a line of commenting.</em></div>
<div class="tip" id="fs2">union case lineOfCode.Code: string -&gt; lineOfCode</div>
<div class="tip" id="fs3">Multiple items<br />val string : value:&#39;T -&gt; string<br /><br />Full name: Microsoft.FSharp.Core.Operators.string<br /><br />--------------------<br />type string = String<br /><br />Full name: Microsoft.FSharp.Core.string</div>
<div class="tip" id="fs4">union case lineOfCode.Comment: string -&gt; lineOfCode</div>
<div class="tip" id="fs5">type allocation = | Allocation of string * string option<br /><br />Full name: ShrinkRay.allocation<br /><em><br /><br />&#160;Represent bindings of args, parameters, variables as a name<br />&#160;and optional type information.</em></div>
<div class="tip" id="fs6">union case allocation.Allocation: string * string option -&gt; allocation</div>
<div class="tip" id="fs7">type &#39;T option = Option&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Core.option&lt;_&gt;</div>
<div class="tip" id="fs8">type procedureInfo =<br />&#160;&#160;{Name: string;<br />&#160;&#160;&#160;Args: allocation list option;<br />&#160;&#160;&#160;LinesOfCode: seq&lt;lineOfCode&gt;;}<br /><br />Full name: ShrinkRay.procedureInfo<br /><em><br /><br />&#160;Record of information about a procedure call.</em></div>
<div class="tip" id="fs9">procedureInfo.Name: string<br /><em><br /><br />&#160;The name bound to the procudure.</em></div>
<div class="tip" id="fs10">procedureInfo.Args: allocation list option<br /><em><br /><br />&#160;The optional list of arguments required to call the procedure.</em></div>
<div class="tip" id="fs11">type &#39;T list = List&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.list&lt;_&gt;</div>
<div class="tip" id="fs12">procedureInfo.LinesOfCode: seq&lt;lineOfCode&gt;<br /><em><br /><br />&#160;All of the lines of code that make up the procedure, inclusive of the<br />&#160;procedure decleration, ending and comments.</em></div>
<div class="tip" id="fs13">Multiple items<br />val seq : sequence:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Core.Operators.seq<br /><br />--------------------<br />type seq&lt;&#39;T&gt; = Collections.Generic.IEnumerable&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.seq&lt;_&gt;</div>
<div class="tip" id="fs14">type procedure =<br />&#160;&#160;| Sub of procedureInfo<br />&#160;&#160;| Function of procedureInfo<br /><br />Full name: ShrinkRay.procedure<br /><em><br /><br />&#160;Available types of procedure calls - procedures are either Sub-Procedures<br />&#160;or they are Function-Procedures.</em></div>
<div class="tip" id="fs15">union case procedure.Sub: procedureInfo -&gt; procedure</div>
<div class="tip" id="fs16">union case procedure.Function: procedureInfo -&gt; procedure</div>
<div class="tip" id="fs17">val maybe : f:(&#39;a -&gt; &#39;b) -&gt; a:&#39;a option -&gt; &#39;b option<br /><br />Full name: ShrinkRay.maybe<br /><em><br /><br />&#160;Applies a function &#39;f&#39; to an option &#39;a&#39;, where &#39;a&#39; has a value and returns<br />&#160;some value - else the result is obviously nothing.</em></div>
<div class="tip" id="fs18">val f : (&#39;a -&gt; &#39;b)</div>
<div class="tip" id="fs19">val a : &#39;a option</div>
<div class="tip" id="fs20">union case Option.Some: &#39;T -&gt; Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs21">val b : &#39;a</div>
<div class="tip" id="fs22">union case Option.None: Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs23">val isAny : xs:&#39;a -&gt; &#39;a option (requires &#39;a :&gt; seq&lt;&#39;b&gt;)<br /><br />Full name: ShrinkRay.isAny<br /><em><br /><br />&#160;Turns a collection into an optional collection - where an empty collection<br />&#160;is represented as nothing.</em></div>
<div class="tip" id="fs24">val xs : #seq&lt;&#39;b&gt;</div>
<div class="tip" id="fs25">module Seq<br /><br />from Microsoft.FSharp.Collections</div>
<div class="tip" id="fs26">val isEmpty : source:seq&lt;&#39;T&gt; -&gt; bool<br /><br />Full name: Microsoft.FSharp.Collections.Seq.isEmpty</div>
<div class="tip" id="fs27">val normalizeLineEndings : ending:string -&gt; s:string -&gt; string<br /><br />Full name: ShrinkRay.normalizeLineEndings<br /><em><br /><br />&#160;Normalize line endings in a string.</em></div>
<div class="tip" id="fs28">val ending : string</div>
<div class="tip" id="fs29">val s : string</div>
<div class="tip" id="fs30">Multiple items<br />type Regex =<br />&#160;&#160;new : pattern:string -&gt; Regex + 2 overloads<br />&#160;&#160;member GetGroupNames : unit -&gt; string[]<br />&#160;&#160;member GetGroupNumbers : unit -&gt; int[]<br />&#160;&#160;member GroupNameFromNumber : i:int -&gt; string<br />&#160;&#160;member GroupNumberFromName : name:string -&gt; int<br />&#160;&#160;member IsMatch : input:string -&gt; bool + 1 overload<br />&#160;&#160;member Match : input:string -&gt; Match + 2 overloads<br />&#160;&#160;member MatchTimeout : TimeSpan<br />&#160;&#160;member Matches : input:string -&gt; MatchCollection + 1 overload<br />&#160;&#160;member Options : RegexOptions<br />&#160;&#160;...<br /><br />Full name: System.Text.RegularExpressions.Regex<br /><br />--------------------<br />Regex(pattern: string) : unit<br />Regex(pattern: string, options: RegexOptions) : unit<br />Regex(pattern: string, options: RegexOptions, matchTimeout: TimeSpan) : unit</div>
<div class="tip" id="fs31">Regex.Replace(input: string, pattern: string, evaluator: MatchEvaluator) : string<br />Regex.Replace(input: string, pattern: string, replacement: string) : string<br />Regex.Replace(input: string, pattern: string, evaluator: MatchEvaluator, options: RegexOptions) : string<br />Regex.Replace(input: string, pattern: string, replacement: string, options: RegexOptions) : string<br />Regex.Replace(input: string, pattern: string, evaluator: MatchEvaluator, options: RegexOptions, matchTimeout: TimeSpan) : string<br />Regex.Replace(input: string, pattern: string, replacement: string, options: RegexOptions, matchTimeout: TimeSpan) : string</div>
<div class="tip" id="fs32">val split : splitters:string [] -&gt; s:string -&gt; seq&lt;string&gt;<br /><br />Full name: ShrinkRay.split<br /><em><br /><br />&#160;Splits a string based on a an array of given splitter strings. By default<br />&#160;we will remove all empty entries from the result set.</em></div>
<div class="tip" id="fs33">val splitters : string []</div>
<div class="tip" id="fs34">String.Split(params separator: char []) : string []<br />String.Split(separator: string [], options: StringSplitOptions) : string []<br />String.Split(separator: char [], options: StringSplitOptions) : string []<br />String.Split(separator: char [], count: int) : string []<br />String.Split(separator: string [], count: int, options: StringSplitOptions) : string []<br />String.Split(separator: char [], count: int, options: StringSplitOptions) : string []</div>
<div class="tip" id="fs35">type StringSplitOptions =<br />&#160;&#160;| None = 0<br />&#160;&#160;| RemoveEmptyEntries = 1<br /><br />Full name: System.StringSplitOptions</div>
<div class="tip" id="fs36">field StringSplitOptions.RemoveEmptyEntries = 1</div>
<div class="tip" id="fs37">val ofArray : source:&#39;T [] -&gt; seq&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.Seq.ofArray</div>
<div class="tip" id="fs38">val trim : s:string -&gt; string<br /><br />Full name: ShrinkRay.trim<br /><em><br /><br />&#160;Trims both ends of a specified string.</em></div>
<div class="tip" id="fs39">String.Trim() : string<br />String.Trim(params trimChars: char []) : string</div>
<div class="tip" id="fs40">val trimAll : xs:seq&lt;string&gt; -&gt; seq&lt;string&gt;<br /><br />Full name: ShrinkRay.trimAll<br /><em><br /><br />&#160;Trims both ends of all strings in a specified collection.</em></div>
<div class="tip" id="fs41">val xs : seq&lt;string&gt;</div>
<div class="tip" id="fs42">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; source:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;U&gt;<br /><br />Full name: Microsoft.FSharp.Collections.Seq.map</div>
<div class="tip" id="fs43">val startsWith : find:string -&gt; s:string -&gt; bool<br /><br />Full name: ShrinkRay.startsWith<br /><em><br /><br />&#160;Results in true of a given string starts with a specified string value.</em></div>
<div class="tip" id="fs44">val find : string</div>
<div class="tip" id="fs45">String.StartsWith(value: string) : bool<br />String.StartsWith(value: string, comparisonType: StringComparison) : bool<br />String.StartsWith(value: string, ignoreCase: bool, culture: Globalization.CultureInfo) : bool</div>
<div class="tip" id="fs46">type StringComparison =<br />&#160;&#160;| CurrentCulture = 0<br />&#160;&#160;| CurrentCultureIgnoreCase = 1<br />&#160;&#160;| InvariantCulture = 2<br />&#160;&#160;| InvariantCultureIgnoreCase = 3<br />&#160;&#160;| Ordinal = 4<br />&#160;&#160;| OrdinalIgnoreCase = 5<br /><br />Full name: System.StringComparison</div>
<div class="tip" id="fs47">field StringComparison.CurrentCultureIgnoreCase = 1</div>
<div class="tip" id="fs48">val removeEmpty : (seq&lt;string&gt; -&gt; seq&lt;string&gt; option)<br /><br />Full name: ShrinkRay.removeEmpty<br /><em><br /><br />&#160;Removes all empty empty strings from a given collection, resulting in an<br />&#160;optional collection if there are still any values in it.</em></div>
<div class="tip" id="fs49">val filter : predicate:(&#39;T -&gt; bool) -&gt; source:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.Seq.filter</div>
<div class="tip" id="fs50">Multiple items<br />type String =<br />&#160;&#160;new : value:char -&gt; string + 7 overloads<br />&#160;&#160;member Chars : int -&gt; char<br />&#160;&#160;member Clone : unit -&gt; obj<br />&#160;&#160;member CompareTo : value:obj -&gt; int + 1 overload<br />&#160;&#160;member Contains : value:string -&gt; bool<br />&#160;&#160;member CopyTo : sourceIndex:int * destination:char[] * destinationIndex:int * count:int -&gt; unit<br />&#160;&#160;member EndsWith : value:string -&gt; bool + 2 overloads<br />&#160;&#160;member Equals : obj:obj -&gt; bool + 2 overloads<br />&#160;&#160;member GetEnumerator : unit -&gt; CharEnumerator<br />&#160;&#160;member GetHashCode : unit -&gt; int<br />&#160;&#160;...<br /><br />Full name: System.String<br /><br />--------------------<br />String(value: nativeptr&lt;char&gt;) : unit<br />String(value: nativeptr&lt;sbyte&gt;) : unit<br />String(value: char []) : unit<br />String(c: char, count: int) : unit<br />String(value: nativeptr&lt;char&gt;, startIndex: int, length: int) : unit<br />String(value: nativeptr&lt;sbyte&gt;, startIndex: int, length: int) : unit<br />String(value: char [], startIndex: int, length: int) : unit<br />String(value: nativeptr&lt;sbyte&gt;, startIndex: int, length: int, enc: Text.Encoding) : unit</div>
<div class="tip" id="fs51">String.IsNullOrWhiteSpace(value: string) : bool</div>
<div class="tip" id="fs52">val not : value:bool -&gt; bool<br /><br />Full name: Microsoft.FSharp.Core.Operators.not</div>
<div class="tip" id="fs53">val tokenizeLines : (string -&gt; seq&lt;string&gt; option)<br /><br />Full name: ShrinkRay.tokenizeLines<br /><em><br /><br />&#160;Naive line tokenizer that breaks a string into the separate lines.<br /><br />&#160;TODO: VB syntax allows the use of the &#39;_&#39; character to specify that a line<br />&#160;logically continues onto the next physical line. We should probably handle<br />&#160;this in the future.</em></div>
<div class="tip" id="fs54">val windowsLineEnding : string</div>
<div class="tip" id="fs55">Multiple items<br />val lineOfCode : s:string -&gt; lineOfCode<br /><br />Full name: ShrinkRay.lineOfCode<br /><em><br /><br />&#160;VB syntax defines the &#39; character as a way to mark a comment follows. Since<br />&#160;all lines (including executable ones) can have a &#39; in them, we can at this<br />&#160;point only say that a line starting with a &#39; are purely a line of comment.</em><br /><br />--------------------<br />type lineOfCode =<br />&#160;&#160;| Code of string<br />&#160;&#160;| Comment of string<br /><br />Full name: ShrinkRay.lineOfCode<br /><em><br /><br />&#160;Represents a line of code - which as we know can be only either executable<br />&#160;code or a line of commenting.</em></div>
<div class="tip" id="fs56">val linesOfCode : (string -&gt; seq&lt;lineOfCode&gt; option)<br /><br />Full name: ShrinkRay.linesOfCode<br /><em><br /><br />&#160;Map function to turn a collection of strings into an optional collection of<br />&#160;lines of code.</em></div>
<div class="tip" id="fs57">val ( test linesOfCode ) : str:string -&gt; name:string -&gt; unit<br /><br />Full name: ShrinkRay.( test linesOfCode )<br /><em><br /><br />&#160;Takes a string as input and runs it through our &#39;linesOfCode&#39; function<br />&#160;and prints the results in what should be nice and readable.</em></div>
<div class="tip" id="fs58">val str : string</div>
<div class="tip" id="fs59">val name : string</div>
<div class="tip" id="fs60">val printfn : format:Printf.TextWriterFormat&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.printfn</div>
<div class="tip" id="fs61">val lines : seq&lt;lineOfCode&gt;</div>
<div class="tip" id="fs62">val iteri : action:(int -&gt; &#39;T -&gt; unit) -&gt; source:seq&lt;&#39;T&gt; -&gt; unit<br /><br />Full name: Microsoft.FSharp.Collections.Seq.iteri</div>
<div class="tip" id="fs63">val i : int</div>
<div class="tip" id="fs64">val l : lineOfCode</div>
<div class="tip" id="fs65">val codeLineCount : lines:seq&lt;lineOfCode&gt; -&gt; int<br /><br />Full name: ShrinkRay.codeLineCount<br /><em><br /><br />&#160;Counts the number of executable lines of code.</em></div>
<div class="tip" id="fs66">val line : lineOfCode</div>
<div class="tip" id="fs67">val sum : source:seq&lt;&#39;T&gt; -&gt; &#39;T (requires member ( + ) and member get_Zero)<br /><br />Full name: Microsoft.FSharp.Collections.Seq.sum</div>
<div class="tip" id="fs68">val commentLineCount : lines:seq&lt;lineOfCode&gt; -&gt; int<br /><br />Full name: ShrinkRay.commentLineCount<br /><em><br /><br />&#160;Counts the number of comment lines.</em></div>
<div class="tip" id="fs69">val totalLineCount : lines:seq&lt;&#39;a&gt; -&gt; int<br /><br />Full name: ShrinkRay.totalLineCount<br /><em><br /><br />&#160;Counts total number of lines of code.</em></div>
<div class="tip" id="fs70">val lines : seq&lt;&#39;a&gt;</div>
<div class="tip" id="fs71">val line : &#39;a</div>
<div class="tip" id="fs72">val ( test aggregate functions ) : str:string -&gt; name:string -&gt; unit<br /><br />Full name: ShrinkRay.( test aggregate functions )<br /><em><br /><br />&#160;Takes a string as input and runs it through our &#39;linesOfCode&#39; function<br />&#160;and prints the results in what should be nice and readable.</em></div>

            </div>
            <div class="span1"></div>
        </div>
    </div>
</body>
</html>